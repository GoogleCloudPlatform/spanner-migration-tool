<script>
  $(document).ready(function () {
    setActiveSelectedMenu('homeScreen');
    jQuery('#loadDbForm > div > input').keyup(function () {
      var empty = false;
      jQuery('#loadDbForm > div > input').each(function () {
        if (jQuery(this).val() === '') {
          empty = true;
        }
      });
      if (empty) {
        jQuery('#loadConnectButton').attr('disabled', 'disabled');
      } else {
        jQuery('#loadConnectButton').removeAttr('disabled');
      }
    });
    jQuery('#connectForm > div > input').keyup(function () {
      var empty = false;
      jQuery('#connectForm > div > input').each(function () {
        if (jQuery(this).val() === '') {
          empty = true;
        }
      });
      if (empty) {
        jQuery('#connectButton').attr('disabled', 'disabled');
      }
      else {
        jQuery('#connectButton').removeAttr('disabled');
      }
    });
  });
  sessionArray = JSON.parse(sessionStorage.getItem('sessionStorage'));
  if (sessionArray !== null) {
    let sessionArrayLength = sessionArray.length;
    jQuery('.sessionTableImg').addClass('template');
    jQuery('.sessionTableNoContent').addClass('template');
    for (var x = 0; x < sessionArrayLength; x++) {
      let session = sessionArray[x];
      let sessionName = session.fileName;
      let sessionDate = session.createdAt.substr(0, session.createdAt.indexOf("T"));
      let sessionTime = session.createdAt.substr(session.createdAt.indexOf("T") + 1);
      let $sessionTableRow = jQuery('.sessions.template').clone().removeClass('template');
      $sessionTableRow.find('.col-2.session-table-td2.sessionName').html(sessionName);
      $sessionTableRow.find('.col-4.session-table-td2.sessionDate').html(sessionDate);
      $sessionTableRow.find('.col-2.session-table-td2.sessionTime').html(sessionTime);
      $sessionTableRow.find('.col-4.session-table-td2.session-action').attr('id', x);
      $sessionTableRow.find('.col-4.session-table-td2.session-action > a').click(function () {
        resumeSessionHandler($sessionTableRow.find('.col-4.session-table-td2.session-action').attr('id'), sessionArray);
      });
      $sessionTableRow.appendTo('#session-table-content');
    }
  }
</script>

<div class="main-content" id='main-screen-content'>
  <h5 class="welcome-heading">
    Welcome To HarbourBridge
  </h5>
  <h5 class="connect-heading">
    Connect or import your database
  </h5>
  <div class="card-section">
    <div class="card-alignment">
      <div class="card-1-alignment">
        <div class="mdc-card connect-db-icon pointer" data-toggle="modal" data-target="#connectToDbModal"
          data-backdrop="static" data-keyboard="false">
          <img src="Icons/Icons/Group 2048.svg" width="64" height="64" style="margin:auto" alt="connect to db">
        </div>
        <div class="connect-text pointer" data-toggle="modal" data-target="#connectToDbModal" data-backdrop="static"
          data-keyboard="false">
          Connect to Database
        </div>
      </div>
      <div class="card-2-alignment">
        <div class="mdc-card connect-db-icon pointer" data-toggle="modal" data-target="#loadDatabaseDumpModal"
          data-backdrop="static" data-keyboard="false">
          <img src="Icons/Icons/Group 2049.svg" width="64" height="64" style="margin:auto" alt="load database image">
        </div>
        <div class="load-text pointer" data-toggle="modal" data-target="#loadDatabaseDumpModal" data-backdrop="static"
          data-keyboard="false">
          Load Database Dump
        </div>
      </div>
      <div class="card-3-alignment">
        <div class="mdc-card connect-db-icon pointer" data-toggle="modal" data-target="#importSchemaModal"
          data-backdrop="static" data-keyboard="false">
          <img src="Icons/Icons/Group 2047.svg" width="64" height="64" style="margin:auto" alt="import schema image">
        </div>
        <div class="import-text pointer" data-toggle="modal" data-target="#importSchemaModal" data-backdrop="static"
          data-keyboard="false">
          Import Schema File
        </div>
      </div>
    </div>
  </div>
  <div id="snackbar"></div>
  <div class='spinner-backdrop' id='toggle-spinner' style="display:none">
    <div id="spinner"></div>
  </div>
  <h4 class="session-heading">Conversion history</h4>
  <table class="table session-table" style="width: 95%;">
    <thead>
      <tr class="d-flex">
        <th class='col-2 session-table-th2'>Session Name</th>
        <th class='col-4 session-table-th2'>Date</th>
        <th class='col-2 session-table-th2'>Time</th>
        <th class='col-4 session-table-th2'>Action Item</th>
      </tr>
    </thead>
    <tbody id='session-table-content'>
      <tr class='sessionTableImg'>
        <td colspan='5' class='center session-image'><img src='Icons/Icons/Group 2154.svg' alt='nothing to show'></td>
      </tr>
      <tr class='sessionTableNoContent'>
        <td colspan='5' class='center simple-grey-text'>No active session available! <br> Please connect a database to
          initiate a new session.</td>
      </tr>
      <tr class='sessions template'>
        <td class='col-2 session-table-td2 sessionName'></td>
        <td class='col-4 session-table-td2 sessionDate'></td>
        <td class='col-2 session-table-td2 sessionTime'></td>
        <td class='col-4 session-table-td2 session-action'>
          <a href='#/schema-report-resume-session' style='cursor: pointer; text-decoration: none;'>Resume Session</a>
        </td>
      </tr>
    </tbody>
  </table>
</div>
<!-- Connect to Db Modal -->
<div class="modal" id="connectToDbModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header content-center">
        <h5 class="modal-title modal-bg" id="exampleModalLongTitle">Connect to Database</h5>
        <i class="large material-icons close" data-dismiss="modal" onclick="clearModal()">cancel</i>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="dbType" class="">Database Type</label>
          <select class="form-control db-select-input" id="dbType" name="dbType" onchange="toggleDbType()">
            <option value="" style="display: none;"></option>
            <option class="db-option" value="mysql">MySQL</option>
            <option class="db-option" value="postgres">Postgres</option>
            <option class='db-option' value='dynamodb'>dynamoDB</option>
          </select>
        </div>
        <div id="sqlFields" style="display: none;">
          <form id="connectForm">
            <div class="form-group">
              <label class="modal-label" for="dbHost">Database Host</label>
              <input type="text" class="form-control db-input" aria-describedby="" name="dbHost" id="dbHost"
                autocomplete="off" onfocusout="validateInput(document.getElementById('dbHost'), 'dbHostError')" />
              <span class='formError' id='dbHostError'></span><br>
            </div>
            <div class="form-group">
              <label class="modal-label" for="dbPort">Database Port</label>
              <input class="form-control db-input" aria-describedby="" type="text" name="dbPort" id="dbPort"
                autocomplete="off" onfocusout="validateInput(document.getElementById('dbPort'), 'dbPortError')" />
              <span class='formError' id='dbPortError'></span><br>
            </div>
            <div class="form-group">
              <label class="modal-label" for="dbUser">Database User</label>
              <input class="form-control db-input" aria-describedby="" type="text" name="dbUser" id="dbUser"
                autocomplete="off" onfocusout="validateInput(document.getElementById('dbUser'), 'dbUserError')" />
              <span class='formError' id='dbUserError'></span><br>
            </div>
            <div class="form-group">
              <label class="modal-label" for="dbName">Database Name</label>
              <input class="form-control db-input" aria-describedby="" type="text" name="dbName" id="dbName"
                autocomplete="off" onfocusout="validateInput(document.getElementById('dbName'), 'dbNameError')" />
              <span class='formError' id='dbNameError'></span><br>
            </div>
            <div class="form-group">
              <label class="modal-label" for="dbPassword">Database Password</label>
              <input class="form-control db-input" aria-describedby="" type="password" name="dbPassword" id="dbPassword"
                autocomplete="off" onfocusout="validateInput(document.getElementById('dbPassword'), 'dbPassError')" />
              <span class='formError' id='dbPassError'></span><br>
            </div>
          </form>
        </div>
      </div>
      <div id="sqlFieldsButtons" style="display: none;">
        <div class="modal-footer">
          <input type="submit" disabled="disabled" value="Connect" id="connectButton" class="connectButton"
            onclick="onconnect( document.getElementById('dbType').value, document.getElementById('dbHost').value, document.getElementById('dbPort').value, document.getElementById('dbUser').value, document.getElementById('dbName').value, document.getElementById('dbPassword').value)" />
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Load Database Dump Modal -->
<div class="modal loadDatabaseDumpModal" id="loadDatabaseDumpModal" tabindex="-1" role="dialog"
  aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header content-center">
        <h5 class="modal-title modal-bg" id="exampleModalLongTitle">Load Database Dump</h5>
        <i class="large material-icons close" data-dismiss="modal" onclick="clearModal()">cancel</i>
      </div>
      <div class="modal-body">
        <!-- <form id="loadDbForm"> -->
        <div class="form-group">
          <label class="" for="loadDbType">Database Type</label>
          <select class="form-control load-db-input" id="loadDbType" name="loadDbType">
            <option value="" style="display: none;"></option>
            <option class="db-option" value="mysql">MySQL</option>
            <option class="db-option" value="postgres">Postgres</option>
          </select>
        </div>
        <form id="loadDbForm">
          <div class="form-group">
            <label class="modal-label" for="dumpFilePath">Path of the Dump File</label>
            <input class="form-control load-db-input" aria-describedby="" type="text" name="dumpFilePath"
              id="dumpFilePath" autocomplete="off"
              onfocusout="validateInput(document.getElementById('dumpFilePath'), 'filePathError')" />
            <span class='formError' id='filePathError'></span>
          </div>
          <input type="text" style="display: none;">
        </form>
      </div>
      <div class="modal-footer">
        <input type="submit" disabled='disabled' value='Confirm' id='loadConnectButton' class='connectButton'
          onclick='storeDumpFileValues(document.getElementById("loadDbType").value, document.getElementById("dumpFilePath").value)' />
      </div>
    </div>
  </div>
</div>
<!-- Import Schema Modal -->
<div class="modal importSchemaModal" id="importSchemaModal" tabindex="-1" role="dialog"
  aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header content-center">
        <h5 class="modal-title modal-bg" id="exampleModalLongTitle">Import Schema File</h5>
        <i class="large material-icons close" data-dismiss="modal" onclick="clearModal()">cancel</i>
      </div>
      <div class="modal-body">
        <form id="importForm" class="importForm">
          <div class="form-group">
            <label class="modal-label" for="importDbType">Database Type</label>
            <select class="form-control import-db-input" id="importDbType" name="importDbType">
              <option value="" style="display: none;"></option>
              <option class="db-option" value="mysql">MySQL</option>
              <option class="db-option" value="postgres">Postgres</option>
            </select>
          </div>
          <div class="form-group">
            <label class="modal-label" for="schemaFile">Schema File</label><br>
            <input class="form-control" aria-describedby="" id="upload" type="file"
              onchange='filenameChangeHandler(event)' />
            <a href="" id="upload_link" onclick='uploadFileHandler(event)'>Upload File</a>â€‹
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <a href='#/schema-report-import-db'><input type='submit' disabled='disabled' id='importButton'
            class='connectButton' value='Confirm'
            onclick='importSourceSchema(document.getElementById("importDbType").value)' /></a>
      </div>
    </div>
  </div>
</div>
<div class="modal" id="connectModalSuccess" role="dialog" tabindex="-1" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header content-center">
        <h5 class="modal-title modal-bg" id="exampleModalLongTitle">Connection Successful</h5>
        <i class="large material-icons close" data-dismiss="modal" onclick='clearModal()'>cancel</i>
      </div>
      <div class="modal-body" style='margin-bottom: 20px; display: inherit;'>
        <div><i class="large material-icons connectionSuccess">check_circle</i></div>
        <div>Please click on convert button to proceed with schema conversion</div>
      </div>
      <div class="modal-footer">
        <a onclick="showSchemaAssessment()"><button id="convert-button" class="connectButton"
            type="button">Convert</button></a>
        <button class="buttonload" id="convertLoaderButton" style="display: none;">
          <i class="fa fa-circle-o-notch fa-spin"></i>converting
        </button>
      </div>
    </div>
  </div>
</div>
<div class="modal" id="connectModalFailure" role="dialog" tabindex="-1" aria-labelledby="exampleModalCenterTitle"
  aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <!-- Modal content-->
    <div class="modal-content">
      <div class="modal-header content-center">
        <h5 class="modal-title modal-bg" id="exampleModalLongTitle">Connection Failure</h5>
        <i class="large material-icons close" data-dismiss="modal" onclick='clearModal()'>cancel</i>
      </div>
      <div class="modal-body" style='margin-bottom: 20px; display: inherit;'>
        <div><i class="large material-icons connectionFailure">cancel</i></div>
        <div>Please check database configuration details and try again !!</div>
      </div>
      <div class="modal-footer">
        <button data-dismiss="modal" onclick='clearModal()' class="connectButton" type="button">Ok</button>
      </div>
    </div>
  </div>
</div>